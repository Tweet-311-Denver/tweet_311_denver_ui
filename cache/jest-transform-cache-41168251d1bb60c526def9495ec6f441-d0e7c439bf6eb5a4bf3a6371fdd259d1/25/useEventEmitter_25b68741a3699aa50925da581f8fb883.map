{"version":3,"sources":["useEventEmitter.tsx"],"names":["listeners","React","create","target","removeListener","callbacks","index","addListener","emit","canPreventDefault","items","Object","t","event","data","get","defaultPrevented","preventDefault","value","cb"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { EventEmitter, EventConsumer, EventArg } from './types';\n\nexport type NavigationEventEmitter = EventEmitter<Record<string, any>> & {\n  create: (target: string) => EventConsumer<Record<string, any>>;\n};\n\ntype Listeners = ((data: any) => void)[];\n\n/**\n * Hook to manage the event system used by the navigator to notify screens of various events.\n */\nexport default function useEventEmitter(): NavigationEventEmitter {\n  const listeners = React.useRef<Record<string, Record<string, Listeners>>>({});\n\n  const create = React.useCallback((target: string) => {\n    const removeListener = (type: string, callback: (data: any) => void) => {\n      const callbacks = listeners.current[type]\n        ? listeners.current[type][target]\n        : undefined;\n\n      if (!callbacks) {\n        return;\n      }\n\n      const index = callbacks.indexOf(callback);\n\n      callbacks.splice(index, 1);\n    };\n\n    const addListener = (type: string, callback: (data: any) => void) => {\n      listeners.current[type] = listeners.current[type] || {};\n      listeners.current[type][target] = listeners.current[type][target] || [];\n      listeners.current[type][target].push(callback);\n\n      return () => removeListener(type, callback);\n    };\n\n    return {\n      addListener,\n      removeListener,\n    };\n  }, []);\n\n  const emit = React.useCallback(\n    ({\n      type,\n      data,\n      target,\n      canPreventDefault,\n    }: {\n      type: string;\n      data?: any;\n      target?: string;\n      canPreventDefault?: boolean;\n    }) => {\n      const items = listeners.current[type] || {};\n\n      // Copy the current list of callbacks in case they are mutated during execution\n      const callbacks =\n        target !== undefined\n          ? items[target] && items[target].slice()\n          : ([] as Listeners).concat(...Object.keys(items).map(t => items[t]));\n\n      const event: EventArg<any, any, any> = {\n        get type() {\n          return type;\n        },\n      };\n\n      if (data !== undefined) {\n        Object.defineProperty(event, 'data', {\n          get() {\n            return data;\n          },\n        });\n      }\n\n      if (canPreventDefault) {\n        let defaultPrevented = false;\n\n        Object.defineProperties(event, {\n          defaultPrevented: {\n            get() {\n              return defaultPrevented;\n            },\n          },\n          preventDefault: {\n            value() {\n              defaultPrevented = true;\n            },\n          },\n        });\n      }\n\n      callbacks?.forEach(cb => cb(event));\n\n      return event as any;\n    },\n    []\n  );\n\n  return React.useMemo(() => ({ create, emit }), [create, emit]);\n}\n"]}